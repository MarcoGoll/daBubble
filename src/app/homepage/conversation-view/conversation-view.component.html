<div id="app-conversation-view">
    <section id="section-conversation-view">
        <div id="section-conversation-view-content">
            <mat-card id="conversation-view-container" appearance="raised">
                <div class="conversation-view-channel-info">
                    @if(conversationService.currentConversationType == 'empty'){
                    <div class="conversation-empty-container">
                        <h2>Chooose a Conversation</h2>
                    </div>
                    }@else {
                    @if(conversationService.currentConversationType == 'channel'){
                    <div class="channel-container">
                        <!-- TODO: SCSS ChannelName -->
                        {{getChannelName()}}
                    </div>
                    <div class="member-container">
                        <div class="member-images-container">
                            <!-- TODO: SCSS MEMBERS -->
                            @for (member of getChannelMembers(); track member.id; let i = $index) {
                            @if (i<3) { <div class="member-image-container">
                                <img src="./assets/img/character{{member.avatarId}}.svg" alt="">
                        </div>
                        <!-- TODO: Why is the class icon-button-small not working? -->
                        <button (click)="$event.stopPropagation();" class="icon-button-small" mat-icon-button
                            matTooltipPosition="above" matTooltip="Leute hinzufÃ¼gen"
                            (click)="openDialogAddUserToChannel()">
                            <svg class="btnSVG" width="14" height="14" viewBox="0 0 14 14" fill="none"
                                xmlns="http://www.w3.org/2000/svg">
                                <path
                                    d="M7 14C6.71667 14 6.47933 13.904 6.288 13.712C6.096 13.5207 6 13.2833 6 13V8H1C0.716667 8 0.479 7.904 0.287 7.712C0.0956668 7.52067 0 7.28333 0 7C0 6.71667 0.0956668 6.479 0.287 6.287C0.479 6.09567 0.716667 6 1 6H6V1C6 0.716667 6.096 0.479 6.288 0.287C6.47933 0.0956668 6.71667 0 7 0C7.28333 0 7.521 0.0956668 7.713 0.287C7.90433 0.479 8 0.716667 8 1V6H13C13.2833 6 13.5207 6.09567 13.712 6.287C13.904 6.479 14 6.71667 14 7C14 7.28333 13.904 7.52067 13.712 7.712C13.5207 7.904 13.2833 8 13 8H8V13C8 13.2833 7.90433 13.5207 7.713 13.712C7.521 13.904 7.28333 14 7 14Z"
                                    fill="black" />
                            </svg>
                        </button>
                        }@else {
                        @if (i==3){
                        <div class="remaining-members-container">
                            +{{getChannelMembers().length-3}}
                        </div>
                        }
                        }
                        }
                    </div>
                    <div>
                        <!-- TODO: ADD NEW MEMBERS -->
                    </div>
                </div>

                }@else {
                @if(conversationService.currentConversationType == 'user'){
                <div class="user-container">
                    <!-- TODO: Coversation with user ... -->
                </div>
                }
                }
                }


        </div>
        <div class="conversation-view-messages">
            @for (date of conversationService.allMessageDatesCurrentConversation; track $index) {
            <div class="message-divider">
                <span class="message-timestamp">{{date}}</span>
            </div>
            @for (message of conversationService.getCurrentConversation().messageBlock.messages ; track $index){
            @if (date === (message.timestamp| date:'EEEE, d. MMMM')) {
            <div class="message-content"
                [ngClass]="{'other-message-content':!checkIsMyMessage(message.sender), 'my-message-content': checkIsMyMessage(message.sender)}">
                <img class="avatar-image"
                    src="./assets/img/character{{userService.getUserByUid(message.sender)?.avatarId}}.svg"
                    alt="Avatar Image">
                <div class="message-info"
                    [ngClass]="{'other-message-info':!checkIsMyMessage(message.sender), 'my-message-info': checkIsMyMessage(message.sender)}">
                    <div class="message-info-sender"
                        [ngClass]="{'other-message-info-sender':!checkIsMyMessage(message.sender), 'my-message-info-sender': checkIsMyMessage(message.sender)}">
                        <span class="sender">{{userService.getUserByUid(message.sender)?.fullName}}</span>
                        <span class="time">{{message.timestamp| date:'HH:mm'}}</span>
                    </div>
                    <div class="message-info-text-container">
                        <span class="message-info-text">{{message.text}}</span>
                    </div>
                    <div class="message-info-responses"
                        [ngClass]="{'other-message-info-responses':!checkIsMyMessage(message.sender), 'my-message-info-responses': checkIsMyMessage(message.sender)}">
                        <span>2 Antworten</span>
                        <span class="time">Letzte Antwort 14:56</span>
                    </div>
                </div>
            </div>
            }
            }
            }
        </div>
        <div class="conversation-view-new-message">
            <textarea class="new-message-textarea" [(ngModel)]="newMessageText"
                placeholder="Nachricht senden ..."></textarea>
            <div class="new-message-controls">
                <div class="new-message-special-btns">
                    <button class="new-message-icon-btn">smile</button>
                    <button class="new-message-at-btn">&#64;</button>
                </div>
                <button class="new-message-send-btn" (click)="createNewMessage()">senden</button>
            </div>
        </div>
        </mat-card>
</div>
</section>
</div>